<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vanilla SPA — Markdown Docs</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    :root{
      --bg: #f5f7fa; --card:#ffffff; --muted:#6b7280; --accent:#2563eb; --text:#0f172a; --nav:#111827;
    }
    [data-theme="dark"]{
      --bg:#0b1220; --card:#071026; --muted:#9ca3af; --accent:#60a5fa; --text:#e6eef8; --nav:#020617;
    }

    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:var(--bg); color:var(--text)}

    header{background:var(--nav); color:var(--text); padding:14px 18px; display:flex; align-items:center; gap:12px}
    header h1{font-size:18px; margin:0}
    header .controls{margin-left:auto; display:flex; gap:8px; align-items:center}
    header button{background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--text); padding:8px 10px; border-radius:8px; cursor:pointer}

    nav.top{display:flex; gap:8px; align-items:center; padding:10px 18px; background:linear-gradient(90deg, rgba(0,0,0,0.02), transparent)}
    nav.top input[type=search]{width:320px; padding:8px 10px; border-radius:8px; border:1px solid #ddd}

    #layout{display:flex; gap:20px; max-width:1100px; margin:20px auto; padding:0 16px}
    #sidebar{width:280px; background:var(--card); border-radius:10px; padding:12px; box-shadow:0 6px 18px rgba(2,6,23,0.06); height:calc(100vh - 180px); overflow:auto}

    .folder{margin-bottom:8px}
    .folder-header{display:flex; justify-content:space-between; align-items:center; cursor:pointer; padding:8px; border-radius:8px}
    .folder-header:hover{background:rgba(0,0,0,0.03)}
    .folder-title{font-weight:600}
    .files{padding-left:8px; margin-top:6px}
    .files a{display:block; padding:6px 8px; border-radius:6px; text-decoration:none; color:var(--text)}
    .files a:hover{background:rgba(0,0,0,0.03)}

    #main{flex:1}
    .card{background:var(--card); border-radius:10px; padding:22px; box-shadow:0 6px 18px rgba(2,6,23,0.06); min-height:300px}

    .breadcrumbs{font-size:14px; color:var(--muted); margin-bottom:12px}
    .search-results{position:absolute; background:var(--card); width:320px; max-height:320px; overflow:auto; box-shadow:0 6px 18px rgba(2,6,23,0.08); border-radius:8px; margin-top:6px}
    .result{padding:8px 10px; border-bottom:1px solid rgba(0,0,0,0.03)}
    .result a{color:var(--text); text-decoration:none}

    footer{max-width:1100px;margin:28px auto; color:var(--muted); font-size:13px}

    @media (max-width:900px){#sidebar{display:none} header h1{font-size:15px} nav.top input[type=search]{width:180px}}
  </style>
</head>
<body>

<header>
  <h1 id="header-title">Vanilla Markdown SPA</h1>
  <div class="controls">
    <button id="toggle-theme" title="Toggle dark mode">Toggle Theme</button>
    <button id="toggle-sidebar" title="Toggle sidebar">Toggle Sidebar</button>
  </div>
</header>

<nav class="top">
  <div style="position:relative">
    <input id="search" type="search" placeholder="Search docs (title or content)..." aria-label="Search docs" />
    <div id="search-results" class="search-results" style="display:none"></div>
  </div>
  <div style="margin-left:auto" id="breadcrumb-wrap"></div>
</nav>

<div id="layout">
  <aside id="sidebar"></aside>

  <main id="main">
    <div id="content" class="card">Loading...</div>
  </main>
</div>

<footer>
  <div id="layout-footer">Made with ❤️ — single-file static SPA</div>
</footer>

<script>
// Content structure - will be populated from actual files
const CONTENT_STRUCTURE = {
  home: ['index'],
  about: ['index', 'team'],
  blog: ['index', 'first-post', 'second-post'],
  docs: ['index', 'installation', 'usage']
};

// Cache for loaded markdown content
const CONTENT_CACHE = {};

// Layout content
let LAYOUT = { header: `# My Site`, footer: `© ${new Date().getFullYear()} — Built with ❤️` };

// Helpers
function titleCase(s){ return s.charAt(0).toUpperCase()+s.slice(1) }

// Theme
const root = document.documentElement;
function setTheme(t){ if(t==='dark') root.setAttribute('data-theme','dark'); else root.removeAttribute('data-theme'); localStorage.setItem('spa-theme',t)}
(function(){ const saved = localStorage.getItem('spa-theme')||'light'; setTheme(saved); })();

// Load markdown file from content directory
async function loadMarkdown(folder, file) {
  const cacheKey = `${folder}/${file}`;
  if (CONTENT_CACHE[cacheKey]) {
    return CONTENT_CACHE[cacheKey];
  }
  
  try {
    const path = `content/${folder}/${file}.md`;
    const response = await fetch(path);
    if (!response.ok) {
      throw new Error(`Failed to load: ${path}`);
    }
    const text = await response.text();
    CONTENT_CACHE[cacheKey] = text;
    return text;
  } catch (error) {
    console.error('Error loading markdown:', error);
    return `# Error\n\nFailed to load content: ${folder}/${file}`;
  }
}

// Load layout files
async function loadLayout() {
  try {
    const [headerRes, footerRes] = await Promise.all([
      fetch('content/_header.md').catch(() => null),
      fetch('content/_footer.md').catch(() => null)
    ]);
    
    if (headerRes && headerRes.ok) {
      const headerText = await headerRes.text();
      // Extract title from header (first line or first # heading)
      const headerLines = headerText.split('\n');
      const titleLine = headerLines.find(line => line.trim().startsWith('#'));
      if (titleLine) {
        document.getElementById('header-title').textContent = titleLine.replace(/^#+\s*/, '').trim();
      }
      LAYOUT.header = headerText;
    }
    
    if (footerRes && footerRes.ok) {
      LAYOUT.footer = await footerRes.text();
      // Remove frontmatter if present
      LAYOUT.footer = LAYOUT.footer.replace(/^---\s*\n[\s\S]*?\n---\s*\n/, '');
      document.getElementById('layout-footer').innerHTML = marked.parse(LAYOUT.footer);
    }
  } catch (error) {
    console.error('Error loading layout:', error);
  }
}

// Build sidebar with collapsible folders
function buildSidebar(){
  const sb = document.getElementById('sidebar'); sb.innerHTML='';
  for(const folder of Object.keys(CONTENT_STRUCTURE)){
    const f = document.createElement('div'); f.className='folder';
    const head = document.createElement('div'); head.className='folder-header';
    const title = document.createElement('div'); title.className='folder-title'; title.textContent = titleCase(folder);
    const foldBtn = document.createElement('div'); foldBtn.textContent='▾'; foldBtn.style.opacity=0.7;
    head.appendChild(title); head.appendChild(foldBtn);

    const filesDiv = document.createElement('div'); filesDiv.className='files';
    for(const file of CONTENT_STRUCTURE[folder]){
      const link = document.createElement('a'); 
      link.href = `#/${folder}/${file}`; 
      link.textContent = file === 'index' ? 'Overview' : file.replace(/-/g, ' '); 
      filesDiv.appendChild(link);
    }

    head.addEventListener('click', ()=>{
      const expanded = filesDiv.style.display !== 'none' && filesDiv.style.display !== '';
      filesDiv.style.display = expanded ? 'none' : 'block';
      foldBtn.textContent = expanded ? '▸' : '▾';
    });

    // default collapse behavior: show only 'home' open
    filesDiv.style.display = folder==='home' ? 'block' : 'none';
    foldBtn.textContent = folder==='home' ? '▾' : '▸';

    f.appendChild(head); f.appendChild(filesDiv); sb.appendChild(f);
  }
}

// Breadcrumbs
function buildBreadcrumb(hash){
  const wrap = document.getElementById('breadcrumb-wrap'); wrap.innerHTML='';
  const parts = hash.replace(/^#\//,'').split('/').filter(Boolean);
  if(parts.length===0){ wrap.textContent=''; return }
  const nav = document.createElement('div'); nav.className='breadcrumbs';
  let accum='#';
  const rootLink = document.createElement('a'); rootLink.href='#/home'; rootLink.textContent='Home'; rootLink.style.marginRight='8px'; rootLink.style.color='var(--muted)'; nav.appendChild(rootLink);
  for(let i=0;i<parts.length;i++){
    const p = parts[i]; accum += '/' + p;
    const sep = document.createElement('span'); sep.textContent=' / '; sep.style.color='var(--muted)'; nav.appendChild(sep);
    const a = document.createElement('a'); a.href = accum; a.textContent = p === 'index' ? 'Overview' : p.replace(/-/g, ' '); a.style.marginLeft='6px'; a.style.color='var(--muted)'; nav.appendChild(a);
  }
  wrap.appendChild(nav);
}

// Router: load content based on hash
async function router(){
  const raw = location.hash || '#/home';
  const parts = raw.replace(/^#\//,'').split('/').filter(Boolean);
  const folder = parts[0] || 'home';
  const file = parts[1] || 'index';
  
  // Check if folder exists in structure
  if (!CONTENT_STRUCTURE[folder] || !CONTENT_STRUCTURE[folder].includes(file)) {
    document.getElementById('content').innerHTML = `<h1>404</h1><p>Page not found: ${folder}/${file}</p>`;
    buildBreadcrumb(location.hash || '#/home');
    return;
  }
  
  const md = await loadMarkdown(folder, file);
  document.getElementById('content').innerHTML = marked.parse(md);
  buildBreadcrumb(location.hash || '#/home');
}

// Search: simple full-text search through loaded content
async function searchDocs(q){
  if(!q) return [];
  q = q.toLowerCase();
  const results = [];
  
  // Load all content for search (or search cached content)
  for(const folder of Object.keys(CONTENT_STRUCTURE)){
    for(const file of CONTENT_STRUCTURE[folder]){
      const cacheKey = `${folder}/${file}`;
      let content = CONTENT_CACHE[cacheKey];
      
      // If not cached, try to load it
      if (!content) {
        try {
          const response = await fetch(`content/${folder}/${file}.md`);
          if (response.ok) {
            content = await response.text();
            CONTENT_CACHE[cacheKey] = content;
          }
        } catch (e) {
          continue;
        }
      }
      
      if (content) {
        const text = (file + ' ' + content).toLowerCase();
        if(text.includes(q)){
          results.push({
            folder,
            file,
            excerpt: content.slice(0,120).replace(/\n/g,' ')
          });
        }
      }
    }
  }
  return results;
}

// Wire up search UI
const searchInput = document.getElementById('search');
const resultsEl = document.getElementById('search-results');
let searchTimeout;
searchInput.addEventListener('input', async (e)=>{
  clearTimeout(searchTimeout);
  const q = e.target.value.trim();
  searchTimeout = setTimeout(async ()=>{
    if(!q){ resultsEl.style.display='none'; resultsEl.innerHTML=''; return }
    const res = await searchDocs(q);
    if(res.length===0){ resultsEl.style.display='block'; resultsEl.innerHTML = '<div class="result">No results</div>'; return }
    resultsEl.style.display='block';
    resultsEl.innerHTML = res.map(r=>`<div class="result"><a href="#/${r.folder}/${r.file}"><strong>${r.folder}/${r.file}</strong></a><div style="color:var(--muted);font-size:13px">${r.excerpt}…</div></div>`).join('');

    // click behaviour for results
    Array.from(resultsEl.querySelectorAll('a')).forEach(a=>{
      a.addEventListener('click', ()=>{ resultsEl.style.display='none'; searchInput.value=''; });
    });
  },150);
});

// Controls
document.getElementById('toggle-theme').addEventListener('click', ()=>{
  const cur = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
  setTheme(cur==='dark' ? 'light' : 'dark');
});

let sidebarVisible=true;
document.getElementById('toggle-sidebar').addEventListener('click', ()=>{
  const sb = document.getElementById('sidebar'); sidebarVisible = !sidebarVisible; sb.style.display = sidebarVisible ? 'block' : 'none';
});

// Init
(async function() {
  await loadLayout();
  buildSidebar();
  window.addEventListener('hashchange', router);
  window.addEventListener('load', ()=>{ router(); });
  router(); // Load initial page
})();
</script>
</body>
</html>

